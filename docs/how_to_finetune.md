## **è¿ç§»å­¦ä¹ **

### **æ¦‚è¿°**
è¿ç§»å­¦ä¹  (Transfer Learning) æ˜¯å±äºæ·±åº¦å­¦ä¹ çš„ä¸€ä¸ªå­ç ”ç©¶é¢†åŸŸï¼Œè¯¥ç ”ç©¶é¢†åŸŸçš„ç›®æ ‡åœ¨äºåˆ©ç”¨æ•°æ®ã€ä»»åŠ¡ã€æˆ–æ¨¡å‹ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œå°†åœ¨æ—§é¢†åŸŸå­¦ä¹ è¿‡çš„çŸ¥è¯†ï¼Œè¿ç§»åº”ç”¨äºæ–°é¢†åŸŸä¸­ã€‚é€šä¿—çš„æ¥è®²ï¼Œè¿ç§»å­¦ä¹ å°±æ˜¯è¿ç”¨å·²æœ‰çš„çŸ¥è¯†æ¥å­¦ä¹ æ–°çš„çŸ¥è¯†ï¼Œä¾‹å¦‚å­¦ä¼šäº†éª‘è‡ªè¡Œè½¦çš„äººä¹Ÿèƒ½è¾ƒå¿«çš„å­¦ä¼šéª‘ç”µåŠ¨è½¦ã€‚è¾ƒä¸ºå¸¸ç”¨çš„ä¸€ç§è¿ç§»å­¦ä¹ æ–¹å¼æ˜¯åˆ©ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œå³ç”¨æˆ·åŸºäºå½“å‰ä»»åŠ¡çš„åœºæ™¯ä»PaddleHubä¸­é€‰æ‹©å·²è®­ç»ƒæˆåŠŸçš„æ¨¡å‹è¿›è¡Œæ–°ä»»åŠ¡è®­ç»ƒï¼Œä¸”è¯¥æ¨¡å‹æ›¾ç»ä½¿ç”¨çš„æ•°æ®é›†ä¸æ–°åœºæ™¯çš„æ•°æ®é›†æƒ…å†µç›¸è¿‘ï¼Œæ­¤æ—¶ä»…éœ€è¦åœ¨å½“å‰ä»»åŠ¡åœºæ™¯çš„è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨æ–°åœºæ™¯çš„æ•°æ®å¯¹æ¨¡å‹å‚æ•°è¿›è¡Œå¾®è°ƒï¼ˆ**Fine-tune**ï¼‰ï¼Œå³å¯å®Œæˆè®­ç»ƒä»»åŠ¡ã€‚è¿ç§»å­¦ä¹ å¸å¼•äº†å¾ˆå¤šç ”ç©¶è€…æŠ•èº«å…¶ä¸­ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿå¾ˆå¥½çš„è§£å†³æ·±åº¦å­¦ä¹ ä¸­çš„ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š  
* ä¸€äº›ç ”ç©¶é¢†åŸŸåªæœ‰å°‘é‡æ ‡æ³¨æ•°æ®ï¼Œä¸”æ•°æ®æ ‡æ³¨æˆæœ¬è¾ƒé«˜ï¼Œä¸è¶³ä»¥è®­ç»ƒä¸€ä¸ªè¶³å¤Ÿé²æ£’çš„ç¥ç»ç½‘ç»œã€‚
* å¤§è§„æ¨¡ç¥ç»ç½‘ç»œçš„è®­ç»ƒä¾èµ–äºå¤§é‡çš„è®¡ç®—èµ„æºï¼Œè¿™å¯¹äºä¸€èˆ¬ç”¨æˆ·è€Œè¨€éš¾ä»¥å®ç°ã€‚
* åº”å¯¹äºæ™®é€‚åŒ–éœ€æ±‚çš„æ¨¡å‹ï¼Œåœ¨ç‰¹å®šåº”ç”¨ä¸Šè¡¨ç°ä¸å°½å¦‚äººæ„ã€‚  

ä¸ºäº†è®©å¼€å‘è€…æ›´ä¾¿æ·åœ°åº”ç”¨è¿ç§»å­¦ä¹ ï¼Œé£æ¡¨å¼€æºäº†é¢„è®­ç»ƒæ¨¡å‹ç®¡ç†å·¥å…· PaddleHubã€‚å¼€å‘è€…ä»…ä»…ä½¿ç”¨åä½™è¡Œçš„ä»£ç ï¼Œå°±èƒ½å®Œæˆè¿ç§»å­¦ä¹ ã€‚æœ¬æ–‡å°†ä¸ºè¯»è€…å…¨é¢ä»‹ç»ä½¿ç”¨PaddleHubå®Œæˆè¿ç§»å­¦ä¹ çš„æ–¹æ³•ã€‚

### **å‰ç½®æ¡ä»¶**  
åœ¨å¼€å§‹è¿ç§»å­¦ä¹ ä¹‹å‰ï¼Œç”¨æˆ·éœ€è¦åšå¥½å¦‚ä¸‹å·¥ä½œï¼š  
* ç”¨æˆ·å·²å®‰è£…PaddleHubã€‚
* å‡†å¤‡å¥½ç”¨äºè¿ç§»å­¦ä¹ çš„æ•°æ®ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ä½¿ç”¨PaddleHubæä¾›çš„æ•°æ®é›†æˆ–è€…è‡ªå®šä¹‰æ•°æ®é›†ï¼Œå¦‚æœæ˜¯è‡ªå®šä¹‰æ•°æ®ï¼Œéœ€è¦å‚è€ƒâ€œè‡ªå®šä¹‰æ•°æ®é›†å¦‚ä½•Fine-tuneâ€å¯¹æ•°æ®é›†å¤„ç†ã€‚  
* ä½¿ç”¨hub installå‘½ä»¤å®‰è£…æˆ–æ›´æ–°ç”¨äºè®­ç»ƒçš„moduleï¼Œä»¥ä½¿ç”¨ERNIEæ¨¡å‹ä¸ºä¾‹ï¼Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚ç”¨æˆ·å¯èƒ½åœ¨ä¹‹å‰çš„ä»»åŠ¡ä¸­å·²ç»å®‰è£…è¿‡ç›¸å…³çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œä½†æ˜¯ä»ç„¶æ¨èç”¨æˆ·åœ¨å¼€å§‹è®­ç»ƒå‰æ‰§è¡Œæ­¤æ­¥éª¤ï¼Œè¿™æ ·å¯ä»¥ä¿è¯é¢„è®­ç»ƒæ¨¡å‹æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚


```python
!hub install ernie==1.2.0
```

### **è¿ç§»å­¦ä¹ æµç¨‹**  
ç”¨æˆ·å®Œæˆè¿ç§»å­¦ä¹ å‰éœ€è¦å…ˆç¼–å†™å¥½ç”¨äºè¿ç§»å­¦ä¹ çš„è„šæœ¬ã€‚ç”¨æˆ·ç¼–å†™è„šæœ¬çš„è¿‡ç¨‹éå¸¸ç®€å•ï¼Œä»…éœ€è¦åä½™è¡Œä»£ç å³å¯å®Œæˆã€‚æ•´ä¸ªè„šæœ¬çš„ç¼–å†™è¿‡ç¨‹ï¼Œå¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š
1. å¯¼å…¥å¿…è¦çš„åŒ…ã€‚
2. åŠ è½½é¢„è®­ç»ƒæ¨¡å‹ï¼ˆModuleï¼‰ï¼Œå³åŠ è½½PaddleHubæä¾›çš„é¢„è®­ç»ƒæ¨¡å‹ã€‚
3. åŠ è½½æ•°æ®é›†ï¼ˆDatasetï¼‰ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ä½¿ç”¨datasetå‡½æ•°åŠ è½½PaddleHubè‡ªå¸¦çš„æ•°æ®é›†æˆ–è€…è‡ªè¡Œç¼–å†™åŠ è½½æ•°æ®é›†çš„ç±»æ¥åŠ è½½è‡ªå®šä¹‰æ•°æ®é›†ã€‚
4. é…ç½®æ•°æ®è¯»å–å™¨ï¼ˆReaderï¼‰ï¼Œè´Ÿè´£å°†datasetçš„æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Œä»¥ç‰¹å®šæ ¼å¼ç»„ç»‡å¹¶è¾“å…¥ç»™æ¨¡å‹è¿›è¡Œè®­ç»ƒã€‚
5. é€‰æ‹©ä¼˜åŒ–ç­–ç•¥ï¼ˆStrategyï¼‰ï¼Œä¼˜åŒ–ç­–ç•¥åŒ…å«äº†å¤šç§é¢„è®­ç»ƒå‚æ•°ï¼Œä¾‹å¦‚ä½¿ç”¨ä»€ä¹ˆå­¦ä¹ ç‡å˜åŒ–ç­–ç•¥ï¼Œä½¿ç”¨å“ªç§ç±»å‹çš„ä¼˜åŒ–å™¨ï¼Œä½¿ç”¨ä»€ä¹ˆç±»å‹çš„æ­£åˆ™åŒ–ç­‰ã€‚
6. è®¾ç½®è¿è¡Œé…ç½®ï¼ˆRunConfigï¼‰ï¼ŒRunConfigåŒ…å«äº†ä¸€äº›è®­ç»ƒç›¸å…³çš„é…ç½®ï¼ŒåŒ…æ‹¬æ˜¯å¦ä½¿ç”¨GPUã€è®­ç»ƒçš„è½®æ•°ï¼ˆEpochï¼‰ã€è®­ç»ƒæ‰¹æ¬¡å¤§å°ï¼ˆbatch_sizeï¼‰ç­‰ã€‚
7. ç»„å»ºè®­ç»ƒä»»åŠ¡ï¼ˆTaskï¼‰ï¼Œä¸€ä¸ªè¿ç§»å­¦ä¹ è®­ç»ƒä»»åŠ¡ä¸­ä¼šåŒ…å«ä¸è¯¥ä»»åŠ¡ç›¸å…³çš„Programå’Œä¸Šé¢è®¾ç½®å¥½çš„æ•°æ®è¯»å–å™¨Readerã€è¿è¡Œé…ç½®ç­‰å†…å®¹ã€‚
8. å¯åŠ¨Fine-tuneï¼Œä½¿ç”¨Finetune_and_evalå‡½æ•°å®Œæˆè®­ç»ƒå’Œè¯„ä¼°ã€‚

### **å­¦ä¼šç¼–å†™è¿ç§»å­¦ä¹ è®­ç»ƒè„šæœ¬**  
PaddleHubæä¾›äº†Finetune APIå’Œé¢„è®­ç»ƒæ¨¡å‹å®Œæˆå¤šç§ä¸åŒä»»åŠ¡åœºæ™¯çš„è¿ç§»å­¦ä¹ ï¼ŒåŒ…æ‹¬å›¾åƒåˆ†ç±»ã€æ–‡æœ¬åˆ†ç±»ã€å¤šæ ‡ç­¾åˆ†ç±»ã€åºåˆ—æ ‡æ³¨ã€æ£€ç´¢å¼é—®ç­”ä»»åŠ¡ã€å›å½’ä»»åŠ¡ã€å¥å­è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—ã€é˜…è¯»ç†è§£ä»»åŠ¡ç­‰ã€‚æœ¬æ–‡å°†ä»¥æ–‡æœ¬åˆ†ç±»ä¸ºä¾‹ä»‹ç»è¿ç§»å­¦ä¹ è„šæœ¬çš„ç¼–å†™æ–¹æ³•ã€‚
#### **1. å¯¼å…¥å¿…è¦çš„åŒ…ã€‚**


```python
import paddlehub as hub  
```

####  **2. åŠ è½½é¢„è®­ç»ƒæ¨¡å‹**  
ä½¿ç”¨å¦‚ä¸‹ä»£ç åŠ è½½é¢„è®­ç»ƒæ¨¡å‹ï¼Œæœ¬ä¾‹ä½¿ç”¨ERNIEé¢„è®­ç»ƒæ¨¡å‹æ¥å®Œæˆæ–‡æœ¬åˆ†ç±»ä»»åŠ¡ã€‚ERNIEï¼ˆEnhanced Representation through kNowledge IntEgrationï¼‰æ˜¯ç™¾åº¦æå‡ºçš„è¯­ä¹‰è¡¨ç¤ºæ¨¡å‹ï¼Œä»¥Transformer Encoderä¸ºç½‘ç»œåŸºæœ¬ç»„ä»¶ï¼Œå…¶é¢„è®­ç»ƒè¿‡ç¨‹åˆ©ç”¨äº†æ›´ä¸°å¯Œçš„è¯­ä¹‰çŸ¥è¯†å’Œæ›´å¤šçš„è¯­ä¹‰ä»»åŠ¡ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨è¯¥é¢„è®­ç»ƒæ¨¡å‹éšæ—¶é€æ­¥å¼•å…¥ä¸åŒçš„è‡ªå®šä¹‰ä»»åŠ¡ï¼Œä¾‹å¦‚å‘½åå®ä½“é¢„æµ‹ã€è¯­ç¯‡å…³ç³»è¯†åˆ«ã€å¥å­é¡ºåºé¢„æµ‹ä»»åŠ¡ã€æƒ…æ„Ÿåˆ†æç­‰ã€‚


```python
module = hub.Module(name="ernie")
```

    [32m[2020-07-23 11:26:48,358] [    INFO] - Installing ernie module[0m
    [32m[2020-07-23 11:26:48,360] [    INFO] - Module ernie already installed in /home/aistudio/.paddlehub/modules/ernie[0m
    [32m[2020-07-23 11:26:50,214] [    INFO] - Load pretraining parameters from /home/aistudio/.paddlehub/modules/ernie/assets/params.[0m



PaddleHubè¿˜æä¾›å¾ˆå¤šå…¶ä»–å¯ç”¨äºè¿ç§»å­¦ä¹ çš„é¢„è®­ç»ƒæ¨¡å‹, å…·ä½“å†…å®¹å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œç”¨æˆ·ä»…éœ€è¦æ›¿æ¢nameçš„å–å€¼å³å¯ã€‚  
|æ¨¡å‹å|PaddleHub Moduleä»£ç |
|:--------:|:--------:|
|ERNIE, Chinese|hub.Module(name='ernie')
|ERNIE tiny, Chinese|	hub.Module(name='ernie_tiny')
|ERNIE 2.0 Base, English|	hub.Module(name='ernie_v2_eng_base')
|ERNIE 2.0 Large, English|	hub.Module(name='ernie_v2_eng_large')
|BERT-Base, Uncased|	hub.Module(name='bert_uncased_L-12_H-768_A-12')
|BERT-Large, Uncased|	hub.Module(name='bert_uncased_L-24_H-1024_A-16')
|BERT-Base, Cased|	hub.Module(name='bert_cased_L-12_H-768_A-12')
|BERT-Large, Cased|	hub.Module(name='bert_cased_L-24_H-1024_A-16')
|BERT-Base, Multilingual Cased|	hub.Module(nane='bert_multi_cased_L-12_H-768_A-12')
|BERT-Base, Chinese|	hub.Module(name='bert_chinese_L-12_H-768_A-12')
|BERT-wwm, Chinese|	hub.Module(name='bert_wwm_chinese_L-12_H-768_A-12')
|BERT-wwm-ext, Chinese|	hub.Module(name='bert_wwm_ext_chinese_L-12_H-768_A-12')
|RoBERTa-wwm-ext, Chinese|	hub.Module(name='chinese-roberta-wwm-ext')
|RoBERTa-wwm-ext-large, Chinese|	hub.Module(name='chinese-roberta-wwm-ext-large')
|chinese-electra-small|	hub.Module(name="chinese-electra-small")
|chinese-electra-base|	hub.Module(name="chinese-electra-base")
|rbtl3|	hub.Module(name="rbtl3")
|rbt3|	hub.Module(name="rbt3")

####  **3. åŠ è½½æ•°æ®é›†**  
åœ¨åŠ è½½å¥½é¢„è®­ç»ƒæ¨¡å‹åï¼Œæˆ‘ä»¬æ¥åŠ è½½æ•°æ®é›†ã€‚ç”¨äºè¿ç§»å­¦ä¹ çš„æ•°æ®é›†æ¥æºå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œç”¨æˆ·è‡ªå®šä¹‰æ•°æ®é›†å’ŒPaddleHubæä¾›çš„æ•°æ®é›†ï¼Œä½¿ç”¨ä¸åŒç±»å‹çš„æ•°æ®é›†åŠ è½½æ–¹å¼ä¹Ÿæœ‰æ‰€ä¸åŒã€‚  
##### **åŠ è½½PaddleHubè‡ªå¸¦æ•°æ®é›†**  
å¦‚æœç”¨æˆ·ä½¿ç”¨çš„æ˜¯PaddleHubè‡ªå¸¦æ•°æ®é›†ï¼Œåˆ™å¯ä»¥é€šè¿‡PaddleHubçš„æ•°æ®é›†APIç¼–å†™ä¸€è¡Œä»£ç å®ŒæˆåŠ è½½æ•°æ®é›†çš„åŠ¨ä½œã€‚


```python
dataset = hub.dataset.ChnSentiCorp()
```

    Downloading chnsenticorp.tar.gz
    [==================================================] 100.00%
    Uncompress /home/aistudio/.paddlehub/dataset/chnsenticorp.tar.gz
    [==================================================] 100.00%


å…¶ä¸­ChnSentiCorpæ˜¯ä¸­æ–‡æƒ…æ„Ÿåˆ†ææ•°æ®é›†ï¼Œå…¶ç›®æ ‡æ˜¯åˆ¤æ–­ä¸€æ®µæ–‡æœ¬çš„æƒ…æ„Ÿæ€åº¦ã€‚ä¾‹å¦‚æ–‡æœ¬æ˜¯â€œè¿™é“èœå¾ˆå¥½åƒâ€ï¼Œåˆ™å¯¹åº”çš„æ ‡ç­¾ä¸ºâ€œ1â€ï¼Œè¡¨ç¤ºæ­£å‘è¯„ä»·ï¼Œåˆä¾‹å¦‚â€œæˆ¿é—´å¤ªå°äº†â€ï¼Œå¯¹åº”æ ‡ç­¾ä¸ºâ€œ0â€ï¼Œè¡¨ç¤ºè´Ÿé¢è¯„ä»·ã€‚PaddleHubè¿˜æä¾›äº†å…¶ä»–çš„æ–‡æœ¬åˆ†ç±»æ•°æ®é›†ï¼Œç”¨æˆ·å¯ä»¥è‡ªè¡Œé€‰æ‹©æ•°æ®é›†å¯¹åº”çš„APIæ›¿æ¢ä¸Šé¢ä»£ç ä¸­datasetçš„å–å€¼ï¼Œå…·ä½“ä¿¡æ¯å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚

|æ•°æ®é›†|åç§°|API|
|:--------:|:--------:|:--------:|
|ChnSentiCorp|ä¸­æ–‡æƒ…æ„Ÿåˆ†ææ•°æ®é›†|hub.dataset.ChnSentiCorp()|
|LCQMC|å“ˆå°”æ»¨å·¥ä¸šå¤§å­¦åœ¨è‡ªç„¶è¯­è¨€å¤„ç†å›½é™…é¡¶ä¼š COLING2018 æ„å»ºçš„é—®ç­”åŒ¹é…ä¸­æ–‡æ•°æ®é›†ï¼Œå…¶ç›®æ ‡æ˜¯åˆ¤æ–­ä¸¤ä¸ªé—®é¢˜çš„è¯­ä¹‰æ˜¯å¦ç›¸åŒã€‚|hub.dataset.LCQMC()|
|NLPCC-DPQA|å›½é™…è‡ªç„¶è¯­è¨€å¤„ç†å’Œä¸­æ–‡è®¡ç®—ä¼šè®®NLPCCäº2016å¹´ä¸¾åŠçš„è¯„æµ‹ä»»åŠ¡æ•°æ®é›†ï¼Œï¼Œå…¶ç›®æ ‡æ˜¯é€‰æ‹©èƒ½å¤Ÿå›ç­”é—®é¢˜çš„ç­”æ¡ˆã€‚|hub.dataset.NLPCC_DPQA()|
|MSRA-NER|å¾®è½¯äºšç ”é™¢å‘å¸ƒçš„æ•°æ®é›†ï¼Œå…¶ç›®æ ‡æ˜¯å‘½åå®ä½“è¯†åˆ«|hub.dataset.MSRA-NER()|
|Toxic|è‹±æ–‡å¤šæ ‡ç­¾åˆ†ç±»æ•°æ®é›†|hub.dataset.Toxic()|
|SQUAD|è‹±æ–‡é˜…è¯»ç†è§£æ•°æ®é›†|hub.dataset.SQUAD()|
|GLUE-CoLA|æ–‡æœ¬åˆ†ç±»ä»»åŠ¡æ•°æ®é›†|hub.dataset.GLUE("CoLA")|
|GLUE-SST-2|æƒ…æ„Ÿåˆ†æä»»åŠ¡æ•°æ®é›†|hub.dataset.GLUE("SST-2")|
|GLUE-MNLI|æ–‡æœ¬æ¨ç†ä»»åŠ¡æ•°æ®é›†|hub.dataset.GLUE("MNLI_m")|
|GLUE-QQP|å¥å­å¯¹åˆ†ç±»ä»»åŠ¡æ•°æ®é›†|hub.dataset.GLUE("QQP")|
|GLUE-QNLI|é—®é¢˜æ¨ç†ä»»åŠ¡æ•°æ®é›†|hub.dataset.GLUE("QNLI")|  
|GLUE-STS-B|å›å½’ä»»åŠ¡æ•°æ®é›†|hub.dataset.GLUE("STS-B")|
|GLUE-MRPC|å¥å­å¯¹åˆ†ç±»ä»»åŠ¡æ•°æ®é›†|hub.dataset.GLUE("MRPC")|
|GLUE-RTE|æ–‡æœ¬è•´å«ä»»åŠ¡æ•°æ®é›†|hub.dataset.GLUE("RTE")|
|XNLI|è·¨è¯­è¨€è‡ªç„¶è¯­è¨€æ¨ç†æ•°æ®é›†|hub.dataset.XNLI(language=zh)|
|ChineseGLUE-TNEWS|ä»Šæ—¥å¤´æ¡ä¸­æ–‡æ–°é—»ï¼ˆçŸ­æ–‡æœ¬ï¼‰åˆ†ç±»æ•°æ®é›†|hub.dataset.TNews()|
|ChineseGLUE-INEWS|äº’è”ç½‘æƒ…æ„Ÿåˆ†æä»»åŠ¡æ•°æ®é›†|hub.dataset.INews()|
|DRCD|å°è¾¾é˜…è¯»ç†è§£æ•°æ®é›†ï¼Œå±äºé€šç”¨é¢†åŸŸç¹ä½“ä¸­æ–‡æœºå™¨é˜…è¯»ç†è§£æ•°æ®é›†|hub.dataset.DRCD()|
|CMRC2018|ä¸­æ–‡æœºå™¨é˜…è¯»ç†è§£çš„è·¨åº¦æå–æ•°æ®é›†|hub.dataset.CMRC2018()|
|ChinesGLUE-BQ|æ™ºèƒ½å®¢æœä¸­æ–‡é—®å¥åŒ¹é…æ•°æ®é›†|hub.dataset.BQ()|
|ChineseGLUE-IFLYTEK|ä¸­æ–‡é•¿æ–‡æœ¬åˆ†ç±»æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†å…±æœ‰1.7ä¸‡å¤šæ¡å…³äºappåº”ç”¨æè¿°çš„é•¿æ–‡æœ¬æ ‡æ³¨æ•°æ®|hub.dataset.IFLYTEK()|
|ChineseGLUE-THUCNEWS|ä¸­æ–‡é•¿æ–‡æœ¬åˆ†ç±»æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†å…±æœ‰4ä¸‡å¤šæ¡ä¸­æ–‡æ–°é—»é•¿æ–‡æœ¬æ ‡æ³¨æ•°æ®ï¼Œå…±14ä¸ªç±»åˆ«|hub.dataset.THUCNEWS()|
|DogCatDataset|ç”±Kaggleæä¾›çš„æ•°æ®é›†ï¼Œç”¨äºå›¾åƒäºŒåˆ†ç±»|hub.dataset.DogCatDataset()|
|Food101|ç”±Kaggleæä¾›çš„é£Ÿå“å›¾ç‰‡æ•°æ®é›†ï¼Œå«æœ‰101ç§ç±»åˆ«|hub.dataset.Food101()|
|Indoor67|ç”±éº»çœç†å·¥å­¦é™¢å‘å¸ƒçš„æ•°æ®é›†ï¼Œå…¶åŒ…å«67ç§å®¤å†…åœºæ™¯ï¼Œå…¶ç›®æ ‡æ˜¯è¯†åˆ«ä¸€å¼ å®¤å†…å›¾ç‰‡çš„åœºæ™¯ç±»åˆ«ã€‚|hub.dataset.Indoor67()|
|Flowers|èŠ±å‰æ•°æ®é›†ï¼Œæ•°æ®é›†æœ‰5ç§ç±»å‹ï¼ŒåŒ…æ‹¬"roses"ï¼Œ"tulips"ï¼Œ"daisy"ï¼Œ"sunflowers"ï¼Œ"dandelion"|hub.dataset.Flowers()|
|StanfordDogs|æ–¯å¦ç¦å¤§å­¦å‘å¸ƒçš„æ•°æ®é›†ï¼Œå…¶åŒ…å«120ä¸ªç§ç±»çš„ç‹—ï¼Œç”¨äºåšå›¾åƒåˆ†ç±»ã€‚|hub.dataset.StanfordDogs()|


##### **åŠ è½½è‡ªå®šä¹‰æ•°æ®é›†**  
* åŠ è½½æ–‡æœ¬ç±»è‡ªå®šä¹‰æ•°æ®é›†ã€‚ç”¨æˆ·ä»…éœ€è¦ç»§æ‰¿åŸºç±»BaseNLPDatastï¼Œä¿®æ”¹æ•°æ®é›†å­˜æ”¾åœ°å€ä»¥åŠç±»åˆ«å³å¯ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå¦‚ä¸‹ä»£ç ã€‚  
```
from paddlehub.dataset.base_nlp_dataset import BaseNLPDataset
# æ„å»ºæ•°æ®é›†çš„ç±»
class DemoDataset(BaseNLPDataset):
    def __init__(self):
        # æ•°æ®é›†å®é™…è·¯å¾„
        self.dataset_dir = "path/to/dataset"
        super(DemoDataset, self).__init__(
            base_path=self.dataset_dir,
            train_file="train.tsv", # è®­ç»ƒé›†å­˜æ”¾åœ°å€
            dev_file="dev.tsv",    # éªŒè¯é›†å­˜æ”¾åœ°å€
            test_file="test.tsv",   # æµ‹è¯•é›†å­˜æ”¾åœ°å€
            # å¦‚æœè¿˜æœ‰é¢„æµ‹æ•°æ®ï¼ˆä¸éœ€è¦æ–‡æœ¬ç±»åˆ«labelï¼‰ï¼Œå¯ä»¥æ”¾åœ¨predict.tsv
            predict_file="predict.tsv",
            train_file_with_header=True,   # è®­ç»ƒé›†æ–‡ä»¶æ˜¯å¦æœ‰åˆ—è¯´æ˜
            dev_file_with_header=True,     # éªŒè¯é›†æ–‡ä»¶æ˜¯å¦æœ‰åˆ—è¯´æ˜
            test_file_with_header=True,    # æµ‹è¯•é›†æ–‡ä»¶æ˜¯å¦æœ‰åˆ—è¯´æ˜
            predict_file_with_header=True, # é¢„æµ‹é›†æ–‡ä»¶æ˜¯å¦æœ‰åˆ—è¯´æ˜
            # æ•°æ®é›†ç±»åˆ«é›†åˆ
            label_list=["0", "1"])
# é€šè¿‡åˆ›å»ºDatasetå¯¹è±¡åŠ è½½è‡ªå®šä¹‰æ–‡æœ¬æ•°æ®é›†
dataset = DemoDataset()
```

* åŠ è½½å›¾åƒç±»è‡ªå®šä¹‰æ•°æ®é›†ã€‚ç”¨ç”¨æˆ·ä»…éœ€è¦ç»§æ‰¿åŸºç±»BaseCVDatastï¼Œä¿®æ”¹æ•°æ®é›†å­˜æ”¾åœ°å€å³å¯ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå¦‚ä¸‹ä»£ç ã€‚  
```
from paddlehub.dataset.base_cv_dataset import BaseCVDataset

class DemoDataset(BaseCVDataset):
   def __init__(self):
       # æ•°æ®é›†å­˜æ”¾ä½ç½®
       self.dataset_dir = "/test/data"
       super(DemoDataset, self).__init__(
           base_path=self.dataset_dir,
           train_list_file="train_list.txt",     # è®­ç»ƒé›†å­˜æ”¾åœ°å€
           validate_list_file="validate_list.txt", # éªŒè¯é›†å­˜æ”¾åœ°å€
           test_list_file="test_list.txt",       # æµ‹è¯•é›†å­˜æ”¾åœ°å€
           predict_file="predict_list.txt",      # é¢„æµ‹é›†å­˜æ”¾åœ°å€
           label_list_file="label_list.txt",     # æ•°æ®é›†ç±»åˆ«æ–‡ä»¶æ‰€åœ¨åœ°å€
           # å¦‚æœæ‚¨çš„æ•°æ®é›†ç±»åˆ«è¾ƒå°‘ï¼Œå¯ä»¥ä¸ç”¨å®šä¹‰label_list.txtï¼Œå¯ä»¥åœ¨æœ€åè®¾ç½®label_list=["æ•°æ®é›†æ‰€æœ‰ç±»åˆ«"]ã€‚
           )
# é€šè¿‡åˆ›å»ºDatasetå¯¹è±¡åŠ è½½å›¾åƒç±»æ•°æ®é›†
dataset = DemoDataset()
```

####  **4. é…ç½®æ•°æ®é¢„å¤„ç†å™¨**  
é€šè¿‡ä½¿ç”¨PaddleHubçš„æ•°æ®é¢„å¤„ç†å™¨APIæ¥è¯»å–NLPæˆ–CVçš„æ•°æ®é›†æ•°æ®ã€‚  



```python
reader = hub.reader.ClassifyReader(
    dataset=dataset,
    vocab_path=module.get_vocab_path(),   # è¿”å›é¢„è®­ç»ƒæ¨¡å‹å¯¹åº”çš„è¯è¡¨
    max_seq_len=128,                      # éœ€è¦ä¸Step1ä¸­contextæ¥å£ä¼ å…¥çš„åºåˆ—é•¿åº¦ä¿æŒä¸€è‡´
    sp_model_path=module.get_spm_path(),  # è‹¥moduleä¸ºernie_tinyåˆ™è¿”å›å¯¹åº”çš„å­è¯åˆ‡åˆ†æ¨¡å‹ï¼Œå¦åˆ™è¿”å›None
    word_dict_path=module.get_word_dict_path())  # è‹¥moduleä¸ºernie_tinyåˆ™è¿”å›å¯¹åº”çš„è¯è¯­åˆ‡åˆ†æ¨¡å‹ï¼Œå¦åˆ™è¿”å›None
metrics_choices = ["acc"]
```

    [32m[2020-07-23 11:27:02,714] [    INFO] - Dataset label map = {'0': 0, '1': 1}[0m


å¯¹äºä¸åŒçš„ä»»åŠ¡ç±»å‹ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸åŒçš„Readerã€‚  
|æ•°æ®è¯»å–å™¨|æè¿°|ä»»åŠ¡ç±»å‹|APIç¤ºä¾‹|
|:--------:|:--------:|:--------:|:--------|
|ClassifyReader|é€‚ç”¨äºTransformeré¢„è®­ç»ƒæ¨¡å‹(ERNIE/BERT)çš„æ•°æ®é¢„å¤„ç†å™¨ã€‚|NLP|reader = hub.reader.ClassifyReader(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataset=dataset,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vocab_path=module.get_vocab_path(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_seq_len=128,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp_model_path=module.get_spm_path(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;word_dict_path=module.get_word_dict_path()) |
|LACClassifyReader|ä»¥LACæ¨¡å—ä¸ºåˆ‡è¯å™¨çš„æ•°æ®é¢„å¤„ç†å™¨ï¼Œé€‚ç”¨äºSentaã€ELMoç­‰éœ€è¦ä»¥è¯ç²’åº¦åˆ†è¯çš„ä»»åŠ¡ã€‚|NLP|reader = hub.reader.LACClassifyReader(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataset=dataset,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vocab_path=module.get_vocab_path())|
|SequenceLabelReader|é€‚ç”¨äºTransformerç±»æ¨¡å‹(ERNIE/BERT)çš„åºåˆ—æ ‡æ³¨é¢„å¤„ç†å™¨ã€‚|NLP|reader = hub.reader.SequenceLabelReader(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataset=dataset,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vocab_path=module.get_vocab_path(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_seq_len=128,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp_model_path=module.get_spm_path(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;word_dict_path=module.get_word_dict_path())|
|MultiLabelClassifyReader|é€‚ç”¨äºTransformerç±»æ¨¡å‹(ERNIE/BERT)çš„å¤šæ ‡ç­¾åˆ†ç±»é¢„å¤„ç†å™¨ã€‚|NLP|reader = hub.reader.MultiLabelClassifyReader(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataset=dataset,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vocab_path=module.get_vocab_path(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_seq_len=128)|
|ReadingComprehensionReader|é€‚ç”¨äºTransformerç±»æ¨¡å‹(ERNIE/BERT)çš„é˜…è¯»ç†è§£ä»»åŠ¡é¢„å¤„ç†å™¨ã€‚|NLP|reader = hub.reader.ReadingComprehensionReader(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataset=dataset,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vocab_path=module.get_vocab_path(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_seq_length=384)|
|RegressionReader|é€‚ç”¨äºå›å½’ä»»åŠ¡çš„æ•°æ®é¢„å¤„ç†å™¨ã€‚|NLP|reader = hub.reader.RegressionReader(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataset=dataset,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vocab_path=module.get_vocab_path(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_seq_len=args.max_seq_len)|
|ImageClassificationReader|é€‚ç”¨äºå›¾åƒåˆ†ç±»æ•°æ®çš„é¢„å¤„ç†å™¨ã€‚ä¼šä¿®æ”¹è¾“å…¥å›¾åƒçš„å°ºå¯¸ã€è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ã€å›¾åƒå¢å¹¿å¤„ç†ç­‰æ“ä½œã€‚|CV|reader = hub.reader.ImageClassificationReader(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image_width=module.get_expected_image_width(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image_height=module.get_expected_image_height(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;images_mean=module.get_pretrained_images_mean(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;images_std=module.get_pretrained_images_std(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataset=dataset)|


####  **5. é€‰æ‹©ä¼˜åŒ–ç­–ç•¥**  
åœ¨PaddleHubä¸­ï¼ŒStrategyç±»å°è£…äº†ä¸€ç³»åˆ—é€‚ç”¨äºè¿ç§»å­¦ä¹ çš„Fine-tuningç­–ç•¥ã€‚StrategyåŒ…å«äº†å¯¹é¢„è®­ç»ƒå‚æ•°ä½¿ç”¨ä»€ä¹ˆå­¦ä¹ ç‡å˜åŒ–ç­–ç•¥ï¼Œä½¿ç”¨å“ªç§ç±»å‹çš„ä¼˜åŒ–å™¨ï¼Œä½¿ç”¨ä»€ä¹ˆç±»å‹çš„æ­£åˆ™åŒ–ç­‰ã€‚åœ¨æˆ‘ä»¬è¦åšçš„æ–‡æœ¬åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨AdamWeightDecayStrategyä¼˜åŒ–ç­–ç•¥ã€‚å…·ä½“å¯ä»¥å‚è€ƒå¦‚ä¸‹ä»£ç ï¼š


```python
strategy = hub.AdamWeightDecayStrategy(
    learning_rate=5e-5,   # Fine-tuneè¿‡ç¨‹ä¸­çš„æœ€å¤§å­¦ä¹ ç‡
    weight_decay=0.01,    # æ¨¡å‹çš„æ­£åˆ™é¡¹å‚æ•°ï¼Œé»˜è®¤0.01ï¼Œå¦‚æœæ¨¡å‹æœ‰è¿‡æ‹Ÿåˆå€¾å‘ï¼Œå¯é€‚å½“è°ƒé«˜è¿™ä¸€å‚æ•°
    warmup_proportion=0.1,  #å¦‚æœwarmup_proportion>0, ä¾‹å¦‚0.1, åˆ™å­¦ä¹ ç‡ä¼šåœ¨å‰10%çš„stepsä¸­çº¿æ€§å¢é•¿è‡³æœ€é«˜å€¼learning_rate
    # æœ‰ä¸¤ç§ç­–ç•¥å¯é€‰ï¼š
    # ï¼ˆ1ï¼‰linear_decayç­–ç•¥å­¦ä¹ ç‡ä¼šåœ¨æœ€é«˜ç‚¹åä»¥çº¿æ€§æ–¹å¼è¡°å‡;
    # ï¼ˆ2ï¼‰noam_decayç­–ç•¥å­¦ä¹ ç‡ä¼šåœ¨æœ€é«˜ç‚¹ä»¥å¤šé¡¹å¼å½¢å¼è¡°å‡ï¼›
    lr_scheduler="linear_decay",  
)
```

åŒ…æ‹¬AdamWeightDecayStrategyåœ¨å†…ï¼ŒPaddleHubè¿˜æä¾›äº†å¤šç§ä¼˜åŒ–ç­–ç•¥çš„APIã€‚  
|ä¼˜åŒ–ç­–ç•¥|æè¿°|APIç¤ºä¾‹|  
|:--------:|:--------|:--------|
|DefaultFinetuneStrategy|é»˜è®¤çš„ä¼˜åŒ–ç­–ç•¥ã€‚å…¶å¯¹åº”å‚æ•°å¦‚ä¸‹ï¼š<br>* learning_rate: å…¨å±€å­¦ä¹ ç‡ã€‚é»˜è®¤ä¸º1e-4ã€‚<br>* optimizer_name: ä¼˜åŒ–å™¨åç§°ã€‚é»˜è®¤adamã€‚<br>* regularization_coeff: æ­£åˆ™åŒ–çš„Î»å‚æ•°ã€‚é»˜è®¤ä¸º1e-3ã€‚<br>åœ¨å›¾åƒåˆ†ç±»ä»»åŠ¡ä¸­æ¨èä½¿ç”¨æ­¤ä¼˜åŒ–ç­–ç•¥ã€‚|strategy = hub.DefaultFinetuneStrategy(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;learning_rate=1e-4,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;optimizer_name="adam",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regularization_coeff=1e-3)|
|AdamWeightDecayStrategy|åŸºäºAdamä¼˜åŒ–å™¨çš„å­¦ä¹ ç‡è¡°å‡ç­–ç•¥ã€‚å…¶å¯¹åº”å‚æ•°å¦‚ä¸‹ï¼š<br>* learning_rate: å…¨å±€å­¦ä¹ ç‡ï¼Œé»˜è®¤ä¸º1e-4ã€‚<br>* lr_scheduler: å­¦ä¹ ç‡è°ƒåº¦æ–¹æ³•ï¼Œé»˜è®¤ä¸º"linear_decay"ã€‚<br>* warmup_proportion: warmupæ‰€å æ¯”é‡ã€‚<br>* weight_decay: å­¦ä¹ ç‡è¡°å‡ç‡ã€‚<br>* optimizer_name: ä¼˜åŒ–å™¨åç§°ï¼Œé»˜è®¤ä¸ºadamã€‚<br>åœ¨æ–‡æœ¬åˆ†ç±»ã€é˜…è¯»ç†è§£ç­‰ä»»åŠ¡ä¸­æ¨èä½¿ç”¨æ­¤ä¼˜åŒ–ç­–ç•¥ã€‚|strategy = hub.AdamWeightDecayStrategy(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;learning_rate=1e-4,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lr_scheduler="linear_decay",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warmup_proportion=0.0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weight_decay=0.01,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;optimizer_name="adam")|
|L2SPFinetuneStrategy|ä½¿ç”¨L2SPæ­£åˆ™ä½œä¸ºæƒ©ç½šå› å­çš„Finetuneç­–ç•¥ã€‚å…¶å¯¹åº”å‚æ•°å¦‚ä¸‹ï¼š<br>* learning_rate: å…¨å±€å­¦ä¹ ç‡ã€‚é»˜è®¤ä¸º1e-4ã€‚<br>* optimizer_name: ä¼˜åŒ–å™¨åç§°ã€‚é»˜è®¤adamã€‚<br>* regularization_coeff: æ­£åˆ™åŒ–çš„Î»å‚æ•°ã€‚é»˜è®¤ä¸º1e-3ã€‚|strategy = hub.L2SPFinetuneStrategy(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;learning_rate=1e-4,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;optimizer_name="adam",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regularization_coeff=1e-3)|
|ULMFiTStrategy|è¯¥ç­–ç•¥å®ç°äº†ULMFiTè®ºæ–‡ä¸­æå‡ºçš„ä¸‰ç§ç­–ç•¥ï¼š<br> * Slanted triangular learning ratesæ˜¯ä¸€ç§å­¦ä¹ ç‡å…ˆä¸Šå‡å†ä¸‹é™çš„ç­–ç•¥ã€‚<br>* Discriminative fine-tuningæ˜¯ä¸€ç§å­¦ä¹ ç‡é€å±‚é€’å‡çš„ç­–ç•¥ï¼Œé€šè¿‡è¯¥ç­–ç•¥å¯ä»¥å‡ç¼“åº•å±‚çš„æ›´æ–°é€Ÿåº¦ã€‚<br>* Gradual unfreezingæ˜¯ä¸€ç§é€å±‚è§£å†»çš„ç­–ç•¥ï¼Œé€šè¿‡è¯¥ç­–ç•¥å¯ä»¥ä¼˜å…ˆæ›´æ–°ä¸Šå±‚ï¼Œå†æ…¢æ…¢è§£å†»ä¸‹å±‚å‚ä¸æ›´æ–°ã€‚<br>å…¶å¯¹åº”å‚æ•°å¦‚ä¸‹ï¼š<br> * learning_rate: å…¨å±€å­¦ä¹ ç‡ã€‚é»˜è®¤ä¸º1e-4ã€‚<br> * optimizer_name: ä¼˜åŒ–å™¨åç§°ã€‚é»˜è®¤ä¸ºadamã€‚<br> * cut_fraction: è®¾ç½®Slanted triangular learning rateså­¦ä¹ ç‡ä¸Šå‡çš„æ­¥æ•°åœ¨æ•´ä¸ªè®­ç»ƒæ€»æ­¥æ•°ä¸­çš„æ¯”ä¾‹ã€‚é»˜è®¤ä¸º0.1ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™ä¸é‡‡ç”¨Slanted triangular learning ratesã€‚<br> * ratio: è®¾ç½®Slanted triangular learning ratesä¸‹é™çš„æœ€å°å­¦ä¹ ç‡ä¸ä¸Šå‡çš„æœ€å¤§å­¦ä¹ ç‡çš„æ¯”ä¾‹å…³ç³»ï¼Œé»˜è®¤ä¸º32ï¼Œè¡¨ç¤ºæœ€å°å­¦ä¹ ç‡æ˜¯æœ€å¤§å­¦ä¹ ç‡çš„1/32ã€‚<br> * dis_blocks: è®¾ç½® Discriminative fine-tuningä¸­çš„å—æ•°ã€‚é»˜è®¤ä¸º3ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™ä¸é‡‡ç”¨Discriminative fine-tuningã€‚<br> * factor: è®¾ç½®Discriminative fine-tuningçš„è¡°å‡ç‡ã€‚é»˜è®¤ä¸º2.6ï¼Œè¡¨ç¤ºä¸‹ä¸€å±‚çš„å­¦ä¹ ç‡æ˜¯ä¸Šä¸€å±‚çš„1/2.6ã€‚<br> * frz_blocks: è®¾ç½®Gradual unfreezingä¸­çš„å—æ•°ã€‚å—çš„æ¦‚å¿µåŒâ€œdis_blocksâ€ä¸­ä»‹ç»çš„æ¦‚å¿µã€‚|strategy = hub.ULMFiTStrategy(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;learning_rate=1e-4,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;optimizer_name="adam",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cut_fraction=0.1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ratio=32,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dis_blocks=3,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factor=2.6,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frz_blocks=3)|  



#### **6. è®¾ç½®è¿è¡Œé…ç½®ã€‚**  
åœ¨PaddleHubä¸­ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨APIå‡½æ•°RunConfigé…ç½®Taskè¿›è¡ŒFinetuneæ—¶ä½¿ç”¨çš„å‚æ•°ï¼ŒåŒ…æ‹¬è¿è¡Œçš„Epochæ¬¡æ•°ã€batchçš„å¤§å°ã€æ˜¯å¦ä½¿ç”¨GPUè®­ç»ƒç­‰ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºã€‚  


```python
config = hub.RunConfig(use_cuda=True, num_epoch=3, batch_size=32, strategy=strategy)
```

    [32m[2020-07-23 11:27:15,518] [    INFO] - Checkpoint dir: ckpt_20200723112715[0m


#### **7. ç»„å»ºè®­ç»ƒä»»åŠ¡ã€‚**  
æœ‰äº†åˆé€‚çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œå¹¶åŠ è½½å¥½è¦è¿ç§»çš„æ•°æ®é›†åï¼Œæˆ‘ä»¬å¼€å§‹ç»„å»ºä¸€ä¸ªTaskã€‚åœ¨PaddleHubä¸­ï¼ŒTaskä»£è¡¨äº†ä¸€ä¸ªFine-tuneçš„ä»»åŠ¡ã€‚ä»»åŠ¡ä¸­åŒ…å«äº†æ‰§è¡Œè¯¥ä»»åŠ¡ç›¸å…³çš„Programã€æ•°æ®è¯»å–å™¨Readerã€è¿è¡Œé…ç½®ç­‰å†…å®¹ã€‚åœ¨è¿™é‡Œå¯ä»¥æ‰¾åˆ°æ–‡æœ¬åˆ†ç±»ä»»åŠ¡å¯¹åº”çš„Taskè¯´æ˜[TextClassifierTask](https://github.com/PaddlePaddle/PaddleHub/blob/release/v1.6/docs/reference/task/text_classify_task.md)ã€‚å…·ä½“å®ç°æ–¹æ¡ˆå¦‚ä¸‹ï¼š
1. è·å–moduleï¼ˆPaddleHubçš„é¢„è®­ç»ƒæ¨¡å‹ï¼‰çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ŒåŒ…æ‹¬è¾“å…¥å’Œè¾“å‡ºçš„å˜é‡ï¼Œä»¥åŠPaddle Programï¼ˆå¯æ‰§è¡Œçš„æ¨¡å‹æ ¼å¼ï¼‰ã€‚
2. ä»é¢„è®­ç»ƒæ¨¡å‹çš„è¾“å‡ºå˜é‡ä¸­æ‰¾åˆ°ç‰¹å¾å›¾æå–å±‚feature_mapï¼Œåœ¨feature_mapåé¢æ¥å…¥ä¸€ä¸ªå…¨è¿æ¥å±‚ï¼Œå¦‚ä¸‹ä»£ç ä¸­é€šè¿‡hub.TextClassifierTaskçš„pooled_outputå‚æ•°æŒ‡å®šã€‚
3. ç½‘ç»œçš„è¾“å…¥å±‚ä¿æŒä¸å˜ï¼Œä¾ç„¶ä»è¾“å…¥å±‚å¼€å§‹ï¼Œå¦‚ä¸‹ä»£ç ä¸­é€šè¿‡hub.TextClassifierTaskçš„å‚æ•°feed_listå˜é‡æŒ‡å®šã€‚
hub.TextClassifierTaskå°±æ˜¯é€šè¿‡è¿™ä¸¤ä¸ªå‚æ•°æ˜ç¡®æˆ‘ä»¬çš„æˆªå–æ¨¡å‹ç½‘ç»œçš„è¦æ±‚ï¼ŒæŒ‰ç…§è¿™æ ·çš„é…ç½®ï¼Œæˆ‘ä»¬æˆªå–çš„ç½‘ç»œæ˜¯ä»è¾“å…¥å±‚ä¸€ç›´åˆ°ç‰¹å¾æå–çš„æœ€åä¸€å±‚â€œpooled_outputâ€ï¼Œè¡¨ç¤ºæˆ‘å°†ä½¿ç”¨æˆªå‡ºçš„ç½‘ç»œæ¥è¿›è¡Œè¿ç§»å­¦ä¹ è®­ç»ƒã€‚


```python
# è·å–Moduleçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¾—åˆ°è¾“å…¥ã€è¾“å‡ºä»¥åŠé¢„è®­ç»ƒçš„Paddle Programå‰¯æœ¬ã€‚
# trainableè®¾ç½®ä¸ºTrueæ—¶ï¼ŒModuleä¸­çš„å‚æ•°åœ¨Fine-tuneæ—¶ä¹Ÿä¼šéšä¹‹è®­ç»ƒï¼Œå¦åˆ™ä¿æŒä¸å˜ã€‚
# å…¶ä¸­æœ€å¤§åºåˆ—é•¿åº¦max_seq_lenä¸ºå¯è°ƒæ•´çš„å‚æ•°ï¼Œå»ºè®®å€¼ä¸º128ï¼Œæ ¹æ®ä»»åŠ¡æ–‡æœ¬é•¿åº¦ä¸åŒå¯ä»¥è¿›è¡Œä¿®æ”¹ï¼Œä½†æœ€å¤§ä¸è¶…è¿‡512ã€‚
# è‹¥åºåˆ—é•¿åº¦ä¸è¶³ï¼Œä¼šé€šè¿‡paddingæ–¹å¼è¡¥åˆ°max_seq_len, è‹¥åºåˆ—é•¿åº¦å¤§äºè¯¥å€¼ï¼Œåˆ™ä¼šä»¥æˆªæ–­æ–¹å¼è®©åºåˆ—é•¿åº¦ä¸ºmax_seq_lenã€‚
inputs, outputs, program = module.context(trainable=True, max_seq_len=128)  
# è¿”å›ERNIE/BERTæ¨¡å‹å¯¹åº”çš„[CLS]å‘é‡,å¯ä»¥ç”¨äºå¥å­æˆ–å¥å¯¹çš„ç‰¹å¾è¡¨è¾¾ã€‚
pooled_output = outputs["pooled_output"]

# feed_listçš„Tensoré¡ºåºä¸å¯ä»¥è°ƒæ•´
# æŒ‡å®šERNIEä¸­çš„è¾“å…¥tensorçš„é¡ºåºï¼Œä¸ClassifyReaderè¿”å›çš„ç»“æœä¸€è‡´
feed_list = [  
    inputs["input_ids"].name,  
    inputs["position_ids"].name,
    inputs["segment_ids"].name,
    inputs["input_mask"].name,
]
# é€šè¿‡è¾“å…¥ç‰¹å¾ï¼Œlabelä¸è¿ç§»çš„ç±»åˆ«æ•°ï¼Œå¯ä»¥ç”Ÿæˆé€‚ç”¨äºæ–‡æœ¬åˆ†ç±»çš„è¿ç§»ä»»åŠ¡
cls_task = hub.TextClassifierTask(
    data_reader=reader,               # è¯»å–æ•°æ®çš„reader
    feature=pooled_output,            # ä»é¢„è®­ç»ƒæå–çš„ç‰¹å¾çŸ©é˜µ
    feed_list=feed_list,              # å¾…feedå˜é‡çš„åå­—åˆ—è¡¨
    num_classes=dataset.num_labels,   # æ•°æ®é›†çš„ç±»åˆ«æ•°é‡
    config=config)                    # è¿è¡Œé…ç½®
```

    [32m[2020-07-23 11:27:19,237] [    INFO] - Load pretraining parameters from /home/aistudio/.paddlehub/modules/ernie/assets/params.[0m


PaddleHubé¢„ç½®äº†å¸¸è§ä»»åŠ¡çš„Taskï¼Œæ¯ç§Taskéƒ½æœ‰ç‰¹å®šçš„åº”ç”¨åœºæ™¯å¹¶æä¾›äº†å¯¹åº”çš„åº¦é‡æŒ‡æ ‡ï¼Œæ»¡è¶³ç”¨æˆ·çš„ä¸åŒéœ€æ±‚ã€‚
|Taskç±»å‹|æè¿°|ä»»åŠ¡ç±»å‹|
|:--------:|:--------:|:--------:|
|ImageClassifierTask|è¯¥TaskåŸºäºè¾“å…¥çš„ç‰¹å¾ï¼Œæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…¨è¿æ¥å±‚æ¥åˆ›å»ºä¸€ä¸ªåˆ†ç±»ä»»åŠ¡ç”¨äºFine-tuneï¼Œåº¦é‡æŒ‡æ ‡ä¸ºå‡†ç¡®ç‡ï¼ŒæŸå¤±å‡½æ•°ä¸ºäº¤å‰ç†µLossã€‚|å›¾åƒåˆ†ç±»ä»»åŠ¡|
|TextClassifierTask|è¯¥TaskåŸºäºè¾“å…¥çš„ç‰¹å¾ï¼Œæ·»åŠ ä¸€ä¸ªDropoutå±‚ï¼Œä»¥åŠä¸€ä¸ªæˆ–å¤šä¸ªå…¨è¿æ¥å±‚æ¥åˆ›å»ºä¸€ä¸ªæ–‡æœ¬åˆ†ç±»ä»»åŠ¡ç”¨äºfinetuneï¼Œåº¦é‡æŒ‡æ ‡ä¸ºå‡†ç¡®ç‡ï¼ŒæŸå¤±å‡½æ•°ä¸ºäº¤å‰ç†µLossã€‚|æ–‡æœ¬åˆ†ç±»ä»»åŠ¡|
|SequenceLabelTask|è¯¥TaskåŸºäºè¾“å…¥çš„ç‰¹å¾ï¼Œæ·»åŠ ä¸€ä¸ªå…¨è¿æ¥å±‚æˆ–è€…ä¸€ä¸ªå…¨è¿æ¥å±‚å’ŒCRFå±‚æ¥åˆ›å»ºä¸€ä¸ªåºåˆ—æ ‡æ³¨ä»»åŠ¡ç”¨äºFine-tuneï¼Œåº¦é‡æŒ‡æ ‡ä¸ºF1ï¼ŒæŸå¤±å‡½æ•°ä¸ºäº¤å‰ç†µLossã€‚|åºåˆ—æ ‡æ³¨ä»»åŠ¡|
|MultiLabelClassifierTask|è¯¥TaskåŸºäºè¾“å…¥çš„ç‰¹å¾ï¼Œæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…¨è¿æ¥å±‚æ¥åˆ›å»ºä¸€ä¸ªå¤šæ ‡ç­¾åˆ†ç±»ä»»åŠ¡ç”¨äºfinetuneï¼Œåº¦é‡æŒ‡æ ‡ä¸ºå¤šä¸ªæ ‡ç­¾çš„å¹³å‡AUCï¼ŒæŸå¤±å‡½æ•°ä¸ºå¤šä¸ªæ ‡ç­¾çš„å¹³å‡äº¤å‰ç†µã€‚|å¤šæ ‡ç­¾åˆ†ç±»ä»»åŠ¡|
|RegressionTask|è¯¥TaskåŸºäºè¾“å…¥çš„ç‰¹å¾ï¼Œæ·»åŠ ä¸€ä¸ªDropoutå±‚ï¼Œä»¥åŠä¸€ä¸ªæˆ–å¤šä¸ªå…¨è¿æ¥å±‚æ¥åˆ›å»ºä¸€ä¸ªæ–‡æœ¬å›å½’ä»»åŠ¡ç”¨äºfinetuneï¼Œåº¦é‡æŒ‡æ ‡ä¸ºå‡†ç¡®ç‡ï¼ŒæŸå¤±å‡½æ•°ä¸ºå‡æ–¹å·®æŸå¤±å‡½æ•°ã€‚|æ–‡æœ¬å›å½’ä»»åŠ¡|
|ReadingComprehensionTask|è¯¥TaskåŸºäºè¾“å…¥çš„ç‰¹å¾ï¼Œæ·»åŠ ä¸€ä¸ªå…¨è¿æ¥å±‚æ¥åˆ›å»ºä¸€ä¸ªé˜…è¯»ç†è§£ä»»åŠ¡ç”¨äºFine-tuneï¼ŒæŸå¤±å‡½æ•°ä¸ºäº¤å‰ç†µLossã€‚|é˜…è¯»ç†è§£ä»»åŠ¡|  

åœ¨è®¾å®šæ¯ä¸ªTaskå‰ï¼Œç”¨æˆ·éœ€è¦æå‰äº†è§£å¾…è¿ç§»å­¦ä¹ çš„é¢„è®­ç»ƒæ¨¡å‹çš„è¾“å…¥ä¸è¾“å‡ºï¼Œå³å¯¹åº”ä¸Šé¢ä»£ç ä¸­çš„â€œfeed_listâ€å’Œâ€œpooled_outputâ€ã€‚è¿™éƒ¨åˆ†ä»£ç ç”¨æˆ·å¯ä»¥å‚è€ƒPaddleHubå®˜ç½‘ä¸­æ¯ä¸ªé¢„è®­ç»ƒæ¨¡å‹é¡µé¢å¯¹åº”çš„â€œFine-tuneä»£ç ç¤ºä¾‹â€ã€‚å†ä»¥æƒ…æ„Ÿåˆ†æä»»åŠ¡ä¸ºä¾‹ï¼Œå¦‚æœç”¨æˆ·å¸Œæœ›ä½¿ç”¨â€œsenta_bilstmâ€æ¨¡å‹å®Œæˆæƒ…æ„Ÿåˆ†æä»»åŠ¡ï¼Œåˆ™å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‚è€ƒå®˜ç½‘ä¸Šçš„â€œFine-tuneä»£ç ç¤ºä¾‹â€ç¼–å†™ä»£ç ã€‚
![](https://ai-studio-static-online.cdn.bcebos.com/3aeb6b0587eb43f98c03b66e2878110f9783426922e44784a39edb908aa7f0de)


#### **8 å¯åŠ¨Fine-tuneï¼Œä½¿ç”¨Finetune_and_evalå‡½æ•°å®Œæˆè®­ç»ƒå’Œè¯„ä¼°ã€‚**  


```python
cls_task.finetune_and_eval()
```

æ˜¾ç¤ºä¿¡æ¯å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°è®­ç»ƒçš„è¯„ä¼°ç»“æœï¼ŒLosså€¼å’Œå‡†ç¡®ç‡ç­‰ç­‰ã€‚
```
[2020-07-23 11:31:25,047] [   TRAIN] - step 820 / 900: loss=0.02645 acc=0.99062 [step/sec: 4.08]
[2020-07-23 11:31:27,502] [   TRAIN] - step 830 / 900: loss=0.06491 acc=0.98125 [step/sec: 4.08]
[2020-07-23 11:31:29,957] [   TRAIN] - step 840 / 900: loss=0.03816 acc=0.98438 [step/sec: 4.08]
[2020-07-23 11:31:32,411] [   TRAIN] - step 850 / 900: loss=0.06056 acc=0.98125 [step/sec: 4.08]
[2020-07-23 11:31:34,862] [   TRAIN] - step 860 / 900: loss=0.11149 acc=0.95937 [step/sec: 4.08]
[2020-07-23 11:31:37,315] [   TRAIN] - step 870 / 900: loss=0.07854 acc=0.97188 [step/sec: 4.08]
[2020-07-23 11:31:39,768] [   TRAIN] - step 880 / 900: loss=0.04605 acc=0.98750 [step/sec: 4.08]
[2020-07-23 11:31:42,221] [   TRAIN] - step 890 / 900: loss=0.09920 acc=0.96250 [step/sec: 4.08]
[2020-07-23 11:31:44,671] [   TRAIN] - step 900 / 900: loss=0.06314 acc=0.97813 [step/sec: 4.08]
[2020-07-23 11:31:44,672] [    INFO] - Evaluation on dev dataset start
[2020-07-23 11:31:47,550] [    EVAL] - [dev dataset evaluation result] loss=0.19974 acc=0.93997 [step/sec: 13.35]
[2020-07-23 11:31:47,553] [    INFO] - Evaluation on dev dataset start
[2020-07-23 11:31:50,429] [    EVAL] - [dev dataset evaluation result] loss=0.19974 acc=0.93997 [step/sec: 13.36]
[2020-07-23 11:31:50,431] [    INFO] - Load the best model from ckpt_20200723112715/best_model
[2020-07-23 11:31:51,017] [    INFO] - Evaluation on test dataset start
[2020-07-23 11:31:53,899] [    EVAL] - [test dataset evaluation result] loss=0.16066 acc=0.95066 [step/sec: 13.33]
[2020-07-23 11:31:53,900] [    INFO] - Saving model checkpoint to ckpt_20200723112715/step_900
[2020-07-23 11:31:56,457] [    INFO] - PaddleHub finetune finished.
[<paddlehub.finetune.task.base_task.RunState at 0x7f7b3972ef50>,
 <paddlehub.finetune.task.base_task.RunState at 0x7f7b0a119790>,
 <paddlehub.finetune.task.base_task.RunState at 0x7f7b0a1b5e50>,
 <paddlehub.finetune.task.base_task.RunState at 0x7f7b3972ea50>,
 <paddlehub.finetune.task.base_task.RunState at 0x7f7adc7349d0>,
 <paddlehub.finetune.task.base_task.RunState at 0x7f7b382a2f50>,
 <paddlehub.finetune.task.base_task.RunState at 0x7f7b3825f050>,
 <paddlehub.finetune.task.base_task.RunState at 0x7f7b3972e6d0>,
 <paddlehub.finetune.task.base_task.RunState at 0x7f7b3972e810>,
 ```

é€šè¿‡Fine-tuneå®Œæˆæ¨¡å‹è®­ç»ƒåï¼Œåœ¨å¯¹åº”çš„ckptç›®å½•ï¼ˆCKPT_DIRï¼‰ä¸‹ï¼ŒPaddleHubä¼šè‡ªåŠ¨ä¿å­˜éªŒè¯é›†ä¸Šæ•ˆæœæœ€å¥½çš„æ¨¡å‹ã€‚ç”¨æˆ·å¯ä»¥å‚è€ƒå¦‚ä¸‹ä»£ç è¿›è¡Œé¢„æµ‹ã€‚


```python
import numpy as np


# å¾…é¢„æµ‹æ•°æ®
data = [
    ["è¿™ä¸ªå®¾é¦†æ¯”è¾ƒé™ˆæ—§äº†ï¼Œç‰¹ä»·çš„æˆ¿é—´ä¹Ÿå¾ˆä¸€èˆ¬ã€‚æ€»ä½“æ¥è¯´ä¸€èˆ¬"],
    ["äº¤é€šæ–¹ä¾¿ï¼›ç¯å¢ƒå¾ˆå¥½ï¼›æœåŠ¡æ€åº¦å¾ˆå¥½ æˆ¿é—´è¾ƒå°"],
    ["19å¤©ç¡¬ç›˜å°±ç½¢å·¥äº†~~~ç®—ä¸Šè¿æ¥çš„ä¸€å‘¨éƒ½æ²¡ç”¨ä¸Š15å¤©~~~å¯å°±æ˜¯ä¸èƒ½æ¢äº†~~~å”‰~~~~ä½ è¯´è¿™ç®—ä»€ä¹ˆäº‹å‘€~~~"]
]

index = 0
run_states = cls_task.predict(data=data)
results = [run_state.run_results for run_state in run_states]
for batch_result in results:
    # é¢„æµ‹ç±»åˆ«å–æœ€å¤§åˆ†ç±»æ¦‚ç‡å€¼
    batch_result = np.argmax(batch_result[0], axis=1)
    for result in batch_result:
        print("%s\tpredict=%s" % (data[index][0], result))
        index += 1
```

    [32m[2020-07-23 11:31:56,551] [    INFO] - PaddleHub predict start[0m
    [32m[2020-07-23 11:31:56,552] [    INFO] - The best model has been loaded[0m
    [32m[2020-07-23 11:31:59,496] [    INFO] - PaddleHub predict finished.[0m


    è¿™ä¸ªå®¾é¦†æ¯”è¾ƒé™ˆæ—§äº†ï¼Œç‰¹ä»·çš„æˆ¿é—´ä¹Ÿå¾ˆä¸€èˆ¬ã€‚æ€»ä½“æ¥è¯´ä¸€èˆ¬	predict=0
    äº¤é€šæ–¹ä¾¿ï¼›ç¯å¢ƒå¾ˆå¥½ï¼›æœåŠ¡æ€åº¦å¾ˆå¥½ æˆ¿é—´è¾ƒå°	predict=1
    19å¤©ç¡¬ç›˜å°±ç½¢å·¥äº†~~~ç®—ä¸Šè¿æ¥çš„ä¸€å‘¨éƒ½æ²¡ç”¨ä¸Š15å¤©~~~å¯å°±æ˜¯ä¸èƒ½æ¢äº†~~~å”‰~~~~ä½ è¯´è¿™ç®—ä»€ä¹ˆäº‹å‘€~~~	predict=0
